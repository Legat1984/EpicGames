{"ast":null,"code":"var _jsxFileName = \"C:\\\\work\\\\client\\\\src\\\\components\\\\Platform\\\\contexts\\\\GamesContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst GamesContext = /*#__PURE__*/createContext();\nexport const useGames = () => {\n  _s();\n  const context = useContext(GamesContext);\n  if (!context) {\n    throw new Error('useGames must be used within a GamesProvider');\n  }\n  return context;\n};\n_s(useGames, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nexport const GamesProvider = ({\n  children\n}) => {\n  _s2();\n  const [games, setGames] = useState([]);\n  const [favorites, setFavorites] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  useEffect(() => {\n    const fetchGames = async () => {\n      try {\n        setLoading(true);\n        const response = await fetch(`${process.env.REACT_APP_API_URL}/api/games/games-list`, {\n          headers: {\n            'Content-Type': 'application/json'\n          }\n        });\n        if (!response.ok) {\n          throw new Error(`Ошибка сети: ${response.status} ${response.statusText}`);\n        }\n        const gamesData = await response.json();\n        // Получаем данные пользователя из localStorage\n        const user = JSON.parse(localStorage.getItem('user'));\n\n        // Преобразуем массив избранных ID в Set для быстрого поиска\n        const favoriteGameIds = user && user.favoriteGames ? new Set(user.favoriteGames) : new Set();\n\n        // Добавляем свойство favorite к каждой игре\n        const gamesWithFavorites = gamesData.map(game => ({\n          ...game,\n          favorite: favoriteGameIds.has(game.id)\n        }));\n        setGames(gamesWithFavorites);\n      } catch (error) {\n        console.error('Ошибка получения списка игр:', error);\n        setError(error.message);\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchGames();\n  }, []);\n  useEffect(() => {\n    setFavorites(games.filter(game => game.favorite));\n  }, [games]);\n  const toggleFavorite = async gameId => {\n    try {\n      const currentGame = games.find(game => game.id === gameId);\n      const isFavorite = currentGame ? currentGame.favorite : false;\n      let response;\n      if (!isFavorite) {\n        // Если игра не избранная, добавляем в избранное на сервере\n        response = await fetch(`${process.env.REACT_APP_API_URL}/api/games/favorite/add/${gameId}`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${localStorage.getItem('token')}`\n          }\n        });\n      } else {\n        // Если игра избранная, убираем из избранного на сервере\n        response = await fetch(`${process.env.REACT_APP_API_URL}/api/games/favorite/remove/${gameId}`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${localStorage.getItem('token')}`\n          }\n        });\n      }\n      const result = await response.json();\n      if (response.ok && !result.errors) {\n        // Получаем текущий объект user из localStorage\n        const userData = JSON.parse(localStorage.getItem('user'));\n        if (userData) {\n          let updatedFavoriteGames = [...userData.favoriteGames];\n          if (!isFavorite) {\n            // Добавляем gameId в массив\n            if (!updatedFavoriteGames.includes(gameId)) {\n              updatedFavoriteGames.push(gameId);\n            }\n          } else {\n            // Убираем gameId из массива\n            updatedFavoriteGames = updatedFavoriteGames.filter(id => id !== gameId);\n          }\n          // Обновляем localStorage\n          userData.favoriteGames = updatedFavoriteGames;\n          localStorage.setItem('user', JSON.stringify(userData));\n        }\n\n        // Обновляем локальное состояние\n        setGames(prevGames => prevGames.map(game => game.id === gameId ? {\n          ...game,\n          favorite: !isFavorite\n        } : game));\n      }\n    } catch (error) {\n      console.error('Ошибка при переключении избранного:', error);\n      setGames(prevGames => prevGames.map(game => game.id === gameId ? {\n        ...game,\n        favorite: !game.favorite\n      } : game));\n    }\n  };\n  const value = {\n    games,\n    setGames,\n    favorites,\n    toggleFavorite,\n    loading,\n    error\n  };\n  return /*#__PURE__*/_jsxDEV(GamesContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 137,\n    columnNumber: 5\n  }, this);\n};\n_s2(GamesProvider, \"Yi0Lq0TY9YHB+gFZ+CGA9R9P4Q8=\");\n_c = GamesProvider;\nvar _c;\n$RefreshReg$(_c, \"GamesProvider\");","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","jsxDEV","_jsxDEV","GamesContext","useGames","_s","context","Error","GamesProvider","children","_s2","games","setGames","favorites","setFavorites","loading","setLoading","error","setError","fetchGames","response","fetch","process","env","REACT_APP_API_URL","headers","ok","status","statusText","gamesData","json","user","JSON","parse","localStorage","getItem","favoriteGameIds","favoriteGames","Set","gamesWithFavorites","map","game","favorite","has","id","console","message","filter","toggleFavorite","gameId","currentGame","find","isFavorite","method","result","errors","userData","updatedFavoriteGames","includes","push","setItem","stringify","prevGames","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/work/client/src/components/Platform/contexts/GamesContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\r\n\r\nconst GamesContext = createContext();\r\n\r\nexport const useGames = () => {\r\n  const context = useContext(GamesContext);\r\n  if (!context) {\r\n    throw new Error('useGames must be used within a GamesProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const GamesProvider = ({ children }) => {\r\n  const [games, setGames] = useState([]);\r\n  const [favorites, setFavorites] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const fetchGames = async () => {\r\n      try {\r\n        setLoading(true);\r\n        const response = await fetch(`${process.env.REACT_APP_API_URL}/api/games/games-list`, {\r\n          headers: {\r\n            'Content-Type': 'application/json'\r\n          }\r\n        });\r\n\r\n        if (!response.ok) {\r\n          throw new Error(`Ошибка сети: ${response.status} ${response.statusText}`);\r\n        }\r\n\r\n        const gamesData = await response.json();\r\n        // Получаем данные пользователя из localStorage\r\n        const user = JSON.parse(localStorage.getItem('user'));\r\n\r\n        // Преобразуем массив избранных ID в Set для быстрого поиска\r\n        const favoriteGameIds = user && user.favoriteGames ? new Set(user.favoriteGames) : new Set();\r\n\r\n        // Добавляем свойство favorite к каждой игре\r\n        const gamesWithFavorites = gamesData.map(game => ({\r\n          ...game,\r\n          favorite: favoriteGameIds.has(game.id)\r\n        }));\r\n\r\n        setGames(gamesWithFavorites);\r\n      } catch (error) {\r\n        console.error('Ошибка получения списка игр:', error);\r\n        setError(error.message);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchGames();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    setFavorites(games.filter(game => game.favorite));\r\n  }, [games]);\r\n\r\n  const toggleFavorite = async (gameId) => {\r\n    try {\r\n      const currentGame = games.find(game => game.id === gameId);\r\n      const isFavorite = currentGame ? currentGame.favorite : false;\r\n\r\n      let response;\r\n\r\n      if (!isFavorite) {\r\n        // Если игра не избранная, добавляем в избранное на сервере\r\n        response = await fetch(`${process.env.REACT_APP_API_URL}/api/games/favorite/add/${gameId}`, {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Authorization': `Bearer ${localStorage.getItem('token')}`\r\n          }\r\n        });\r\n      } else {\r\n        // Если игра избранная, убираем из избранного на сервере\r\n        response = await fetch(`${process.env.REACT_APP_API_URL}/api/games/favorite/remove/${gameId}`, {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Authorization': `Bearer ${localStorage.getItem('token')}`\r\n          }\r\n        });\r\n      }\r\n\r\n      const result = await response.json();\r\n\r\n      if (response.ok && !result.errors) {\r\n        // Получаем текущий объект user из localStorage\r\n        const userData = JSON.parse(localStorage.getItem('user'));\r\n        if (userData) {\r\n          let updatedFavoriteGames = [...userData.favoriteGames];\r\n          if (!isFavorite) {\r\n            // Добавляем gameId в массив\r\n            if (!updatedFavoriteGames.includes(gameId)) {\r\n              updatedFavoriteGames.push(gameId);\r\n            }\r\n          } else {\r\n            // Убираем gameId из массива\r\n            updatedFavoriteGames = updatedFavoriteGames.filter(id => id !== gameId);\r\n          }\r\n          // Обновляем localStorage\r\n          userData.favoriteGames = updatedFavoriteGames;\r\n          localStorage.setItem('user', JSON.stringify(userData));\r\n        }\r\n\r\n        // Обновляем локальное состояние\r\n        setGames(prevGames =>\r\n          prevGames.map(game =>\r\n            game.id === gameId ? { ...game, favorite: !isFavorite } : game\r\n          )\r\n        );\r\n      }\r\n    } catch (error) {\r\n      console.error('Ошибка при переключении избранного:', error);\r\n      setGames(prevGames =>\r\n        prevGames.map(game =>\r\n          game.id === gameId ? { ...game, favorite: !game.favorite } : game\r\n        )\r\n      );\r\n    }\r\n  };\r\n\r\n  const value = {\r\n    games,\r\n    setGames,\r\n    favorites,\r\n    toggleFavorite,\r\n    loading,\r\n    error\r\n  };\r\n\r\n  return (\r\n    <GamesContext.Provider value={value}>\r\n      {children}\r\n    </GamesContext.Provider>\r\n  );\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}