{"ast":null,"code":"// Обновление токена\nexport const refreshToken = async () => {\n  const token = localStorage.getItem('token');\n  try {\n    const response = await fetch(`${process.env.REACT_APP_API_URL}/api/users/refresh-token`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${token}`\n      }\n    });\n    const data = await response.json();\n    if (response.ok) {\n      localStorage.setItem('token', data.token);\n      return true;\n    } else {\n      localStorage.removeItem('user');\n      localStorage.removeItem('token');\n      return false;\n    }\n  } catch (error) {\n    console.error('Ошибка при обновлении токена:', error);\n    localStorage.removeItem('user');\n    localStorage.removeItem('token');\n    return false;\n  }\n};\n\n// Проверка токена\nexport const checkToken = async () => {\n  const token = localStorage.getItem('token');\n  if (token) {\n    const decodedToken = JSON.parse(atob(token.split('.')[1]));\n    const currentTime = Date.now() / 1000;\n    const fiveMinutesInSeconds = 300;\n    if (decodedToken.exp < currentTime) {\n      localStorage.removeItem('user');\n      localStorage.removeItem('token');\n      return false;\n    } else if (decodedToken.exp - currentTime <= fiveMinutesInSeconds) {\n      return await refreshToken();\n    } else {\n      return true;\n    }\n  }\n  return false;\n};","map":{"version":3,"names":["refreshToken","token","localStorage","getItem","response","fetch","process","env","REACT_APP_API_URL","method","headers","data","json","ok","setItem","removeItem","error","console","checkToken","decodedToken","JSON","parse","atob","split","currentTime","Date","now","fiveMinutesInSeconds","exp"],"sources":["C:/work/client/src/services/authService.js"],"sourcesContent":["// Обновление токена\r\nexport const refreshToken = async () => {\r\n    const token = localStorage.getItem('token');\r\n    try {\r\n        const response = await fetch(`${process.env.REACT_APP_API_URL}/api/users/refresh-token`, {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Authorization': `Bearer ${token}`\r\n            }\r\n        });\r\n        const data = await response.json();\r\n        if (response.ok) {\r\n            localStorage.setItem('token', data.token);\r\n            return true;\r\n        } else {\r\n            localStorage.removeItem('user');\r\n            localStorage.removeItem('token');\r\n            return false;\r\n        }\r\n    } catch (error) {\r\n        console.error('Ошибка при обновлении токена:', error);\r\n        localStorage.removeItem('user');\r\n        localStorage.removeItem('token');\r\n        return false;\r\n    }\r\n};\r\n\r\n// Проверка токена\r\nexport const checkToken = async () => {\r\n    const token = localStorage.getItem('token');\r\n    if (token) {\r\n        const decodedToken = JSON.parse(atob(token.split('.')[1]));\r\n        const currentTime = Date.now() / 1000;\r\n        const fiveMinutesInSeconds = 300;\r\n\r\n        if (decodedToken.exp < currentTime) {\r\n            localStorage.removeItem('user');\r\n            localStorage.removeItem('token');\r\n            return false;\r\n        } else if ((decodedToken.exp - currentTime) <= fiveMinutesInSeconds) {\r\n            return await refreshToken();\r\n        } else {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n};"],"mappings":"AAAA;AACA,OAAO,MAAMA,YAAY,GAAG,MAAAA,CAAA,KAAY;EACpC,MAAMC,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;EAC3C,IAAI;IACA,MAAMC,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,0BAA0B,EAAE;MACrFC,MAAM,EAAE,MAAM;MACdC,OAAO,EAAE;QACL,cAAc,EAAE,kBAAkB;QAClC,eAAe,EAAE,UAAUT,KAAK;MACpC;IACJ,CAAC,CAAC;IACF,MAAMU,IAAI,GAAG,MAAMP,QAAQ,CAACQ,IAAI,CAAC,CAAC;IAClC,IAAIR,QAAQ,CAACS,EAAE,EAAE;MACbX,YAAY,CAACY,OAAO,CAAC,OAAO,EAAEH,IAAI,CAACV,KAAK,CAAC;MACzC,OAAO,IAAI;IACf,CAAC,MAAM;MACHC,YAAY,CAACa,UAAU,CAAC,MAAM,CAAC;MAC/Bb,YAAY,CAACa,UAAU,CAAC,OAAO,CAAC;MAChC,OAAO,KAAK;IAChB;EACJ,CAAC,CAAC,OAAOC,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAAC,+BAA+B,EAAEA,KAAK,CAAC;IACrDd,YAAY,CAACa,UAAU,CAAC,MAAM,CAAC;IAC/Bb,YAAY,CAACa,UAAU,CAAC,OAAO,CAAC;IAChC,OAAO,KAAK;EAChB;AACJ,CAAC;;AAED;AACA,OAAO,MAAMG,UAAU,GAAG,MAAAA,CAAA,KAAY;EAClC,MAAMjB,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;EAC3C,IAAIF,KAAK,EAAE;IACP,MAAMkB,YAAY,GAAGC,IAAI,CAACC,KAAK,CAACC,IAAI,CAACrB,KAAK,CAACsB,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAC1D,MAAMC,WAAW,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG,IAAI;IACrC,MAAMC,oBAAoB,GAAG,GAAG;IAEhC,IAAIR,YAAY,CAACS,GAAG,GAAGJ,WAAW,EAAE;MAChCtB,YAAY,CAACa,UAAU,CAAC,MAAM,CAAC;MAC/Bb,YAAY,CAACa,UAAU,CAAC,OAAO,CAAC;MAChC,OAAO,KAAK;IAChB,CAAC,MAAM,IAAKI,YAAY,CAACS,GAAG,GAAGJ,WAAW,IAAKG,oBAAoB,EAAE;MACjE,OAAO,MAAM3B,YAAY,CAAC,CAAC;IAC/B,CAAC,MAAM;MACH,OAAO,IAAI;IACf;EACJ;EACA,OAAO,KAAK;AAChB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}